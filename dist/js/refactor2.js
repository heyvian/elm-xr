import{E as e,d as t,e as o,T as n,Q as a,f as i,g as s,P as c,S as r,c as l,H as u,W as d,M as h,a as m,b as p,V as b}from"./a4799280.js";import{ARButton as f}from"./ARButton.js";const g={type:"change"},E={type:"start"},v={type:"end"};class OrbitControls extends e{constructor(e,c){super(),void 0===c&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),c===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=c,this.enabled=!0,this.target=new t,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:o.ROTATE,MIDDLE:o.DOLLY,RIGHT:o.PAN},this.touches={ONE:n.ROTATE,TWO:n.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return h.phi},this.getAzimuthalAngle=function(){return h.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",onKeyDown),this._domElementKeyEvents=e},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(g),r.update(),u=l.NONE},this.update=function(){const o=new t,n=(new a).setFromUnitVectors(e.up,new t(0,1,0)),i=n.clone().invert(),s=new t,c=new a,E=2*Math.PI;return function update(){const e=r.object.position;o.copy(e).sub(r.target),o.applyQuaternion(n),h.setFromVector3(o),r.autoRotate&&u===l.NONE&&rotateLeft(function getAutoRotationAngle(){return 2*Math.PI/60/60*r.autoRotateSpeed}()),r.enableDamping?(h.theta+=m.theta*r.dampingFactor,h.phi+=m.phi*r.dampingFactor):(h.theta+=m.theta,h.phi+=m.phi);let t=r.minAzimuthAngle,a=r.maxAzimuthAngle;return isFinite(t)&&isFinite(a)&&(t<-Math.PI?t+=E:t>Math.PI&&(t-=E),a<-Math.PI?a+=E:a>Math.PI&&(a-=E),h.theta=t<=a?Math.max(t,Math.min(a,h.theta)):h.theta>(t+a)/2?Math.max(t,h.theta):Math.min(a,h.theta)),h.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,h.phi)),h.makeSafe(),h.radius*=p,h.radius=Math.max(r.minDistance,Math.min(r.maxDistance,h.radius)),!0===r.enableDamping?r.target.addScaledVector(b,r.dampingFactor):r.target.add(b),o.setFromSpherical(h),o.applyQuaternion(i),e.copy(r.target).add(o),r.object.lookAt(r.target),!0===r.enableDamping?(m.theta*=1-r.dampingFactor,m.phi*=1-r.dampingFactor,b.multiplyScalar(1-r.dampingFactor)):(m.set(0,0,0),b.set(0,0,0)),p=1,!!(f||s.distanceToSquared(r.object.position)>d||8*(1-c.dot(r.object.quaternion))>d)&&(r.dispatchEvent(g),s.copy(r.object.position),c.copy(r.object.quaternion),f=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",onContextMenu),r.domElement.removeEventListener("pointerdown",onPointerDown),r.domElement.removeEventListener("wheel",onMouseWheel),r.domElement.removeEventListener("touchstart",onTouchStart),r.domElement.removeEventListener("touchend",onTouchEnd),r.domElement.removeEventListener("touchmove",onTouchMove),r.domElement.ownerDocument.removeEventListener("pointermove",onPointerMove),r.domElement.ownerDocument.removeEventListener("pointerup",onPointerUp),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",onKeyDown)};const r=this,l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let u=l.NONE;const d=1e-6,h=new i,m=new i;let p=1;const b=new t;let f=!1;const y=new s,w=new s,T=new s,P=new s,M=new s,O=new s,D=new s,R=new s,L=new s;function getZoomScale(){return Math.pow(.95,r.zoomSpeed)}function rotateLeft(e){m.theta-=e}function rotateUp(e){m.phi-=e}const S=function(){const e=new t;return function panLeft(t,o){e.setFromMatrixColumn(o,0),e.multiplyScalar(-t),b.add(e)}}(),A=function(){const e=new t;return function panUp(t,o){!0===r.screenSpacePanning?e.setFromMatrixColumn(o,1):(e.setFromMatrixColumn(o,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),b.add(e)}}(),x=function(){const e=new t;return function pan(t,o){const n=r.domElement;if(r.object.isPerspectiveCamera){const a=r.object.position;e.copy(a).sub(r.target);let i=e.length();i*=Math.tan(r.object.fov/2*Math.PI/180),S(2*t*i/n.clientHeight,r.object.matrix),A(2*o*i/n.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(S(t*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),A(o*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function dollyOut(e){r.object.isPerspectiveCamera?p/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function dollyIn(e){r.object.isPerspectiveCamera?p*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function handleMouseDownRotate(e){y.set(e.clientX,e.clientY)}function handleMouseDownPan(e){P.set(e.clientX,e.clientY)}function handleTouchStartRotate(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,o)}}function handleTouchStartPan(e){if(1==e.touches.length)P.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);P.set(t,o)}}function handleTouchStartDolly(e){const t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);D.set(0,n)}function handleTouchMoveRotate(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,o)}T.subVectors(w,y).multiplyScalar(r.rotateSpeed);const t=r.domElement;rotateLeft(2*Math.PI*T.x/t.clientHeight),rotateUp(2*Math.PI*T.y/t.clientHeight),y.copy(w)}function handleTouchMovePan(e){if(1==e.touches.length)M.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);M.set(t,o)}O.subVectors(M,P).multiplyScalar(r.panSpeed),x(O.x,O.y),P.copy(M)}function handleTouchMoveDolly(e){const t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);R.set(0,n),L.set(0,Math.pow(R.y/D.y,r.zoomSpeed)),dollyOut(L.y),D.copy(R)}function onPointerDown(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function onMouseDown(e){let t;switch(e.preventDefault(),r.domElement.focus?r.domElement.focus():window.focus(),e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case o.DOLLY:if(!1===r.enableZoom)return;!function handleMouseDownDolly(e){D.set(e.clientX,e.clientY)}(e),u=l.DOLLY;break;case o.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;handleMouseDownPan(e),u=l.PAN}else{if(!1===r.enableRotate)return;handleMouseDownRotate(e),u=l.ROTATE}break;case o.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;handleMouseDownRotate(e),u=l.ROTATE}else{if(!1===r.enablePan)return;handleMouseDownPan(e),u=l.PAN}break;default:u=l.NONE}u!==l.NONE&&(r.domElement.ownerDocument.addEventListener("pointermove",onPointerMove),r.domElement.ownerDocument.addEventListener("pointerup",onPointerUp),r.dispatchEvent(E))}(e)}}function onPointerMove(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function onMouseMove(e){if(!1===r.enabled)return;switch(e.preventDefault(),u){case l.ROTATE:if(!1===r.enableRotate)return;!function handleMouseMoveRotate(e){w.set(e.clientX,e.clientY),T.subVectors(w,y).multiplyScalar(r.rotateSpeed);const t=r.domElement;rotateLeft(2*Math.PI*T.x/t.clientHeight),rotateUp(2*Math.PI*T.y/t.clientHeight),y.copy(w),r.update()}(e);break;case l.DOLLY:if(!1===r.enableZoom)return;!function handleMouseMoveDolly(e){R.set(e.clientX,e.clientY),L.subVectors(R,D),L.y>0?dollyOut(getZoomScale()):L.y<0&&dollyIn(getZoomScale()),D.copy(R),r.update()}(e);break;case l.PAN:if(!1===r.enablePan)return;!function handleMouseMovePan(e){M.set(e.clientX,e.clientY),O.subVectors(M,P).multiplyScalar(r.panSpeed),x(O.x,O.y),P.copy(M),r.update()}(e)}}(e)}}function onPointerUp(e){switch(e.pointerType){case"mouse":case"pen":!function onMouseUp(e){if(r.domElement.ownerDocument.removeEventListener("pointermove",onPointerMove),r.domElement.ownerDocument.removeEventListener("pointerup",onPointerUp),!1===r.enabled)return;r.dispatchEvent(v),u=l.NONE}()}}function onMouseWheel(e){!1===r.enabled||!1===r.enableZoom||u!==l.NONE&&u!==l.ROTATE||(e.preventDefault(),r.dispatchEvent(E),function handleMouseWheel(e){e.deltaY<0?dollyIn(getZoomScale()):e.deltaY>0&&dollyOut(getZoomScale()),r.update()}(e),r.dispatchEvent(v))}function onKeyDown(e){!1!==r.enabled&&!1!==r.enablePan&&function handleKeyDown(e){let t=!1;switch(e.code){case r.keys.UP:x(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:x(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:x(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:x(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function onTouchStart(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(r.touches.ONE){case n.ROTATE:if(!1===r.enableRotate)return;handleTouchStartRotate(e),u=l.TOUCH_ROTATE;break;case n.PAN:if(!1===r.enablePan)return;handleTouchStartPan(e),u=l.TOUCH_PAN;break;default:u=l.NONE}break;case 2:switch(r.touches.TWO){case n.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function handleTouchStartDollyPan(e){r.enableZoom&&handleTouchStartDolly(e),r.enablePan&&handleTouchStartPan(e)}(e),u=l.TOUCH_DOLLY_PAN;break;case n.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function handleTouchStartDollyRotate(e){r.enableZoom&&handleTouchStartDolly(e),r.enableRotate&&handleTouchStartRotate(e)}(e),u=l.TOUCH_DOLLY_ROTATE;break;default:u=l.NONE}break;default:u=l.NONE}u!==l.NONE&&r.dispatchEvent(E)}}function onTouchMove(e){if(!1!==r.enabled)switch(e.preventDefault(),u){case l.TOUCH_ROTATE:if(!1===r.enableRotate)return;handleTouchMoveRotate(e),r.update();break;case l.TOUCH_PAN:if(!1===r.enablePan)return;handleTouchMovePan(e),r.update();break;case l.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function handleTouchMoveDollyPan(e){r.enableZoom&&handleTouchMoveDolly(e),r.enablePan&&handleTouchMovePan(e)}(e),r.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function handleTouchMoveDollyRotate(e){r.enableZoom&&handleTouchMoveDolly(e),r.enableRotate&&handleTouchMoveRotate(e)}(e),r.update();break;default:u=l.NONE}}function onTouchEnd(e){!1!==r.enabled&&(r.dispatchEvent(v),u=l.NONE)}function onContextMenu(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",onContextMenu),r.domElement.addEventListener("pointerdown",onPointerDown),r.domElement.addEventListener("wheel",onMouseWheel,{passive:!1}),r.domElement.addEventListener("touchstart",onTouchStart,{passive:!1}),r.domElement.addEventListener("touchend",onTouchEnd),r.domElement.addEventListener("touchmove",onTouchMove,{passive:!1}),this.update()}}var y,w,T,P,M,O,D,R,L,S,A,x,N,j,k=new c;async function onSessionStarted(e){const t=e.target;(T=new l).matrixAutoUpdate=!1,N||function setMainModel(){var e=j.clone();e.translate(0,.99*e.boundingBox.max.y,1),(N=new m(e,new p({vertexColors:b,size:.085}))).position.copy(x.position),N.visible=!1,P.add(N),console.log("Main model set")}(),A&&(A.visible=!1),x&&(P.add(x),x.visible=!0),D=t.getSession(),R=await D.requestReferenceSpace("local-floor").catch((e=>{console.log(e)}));const o=await D.requestReferenceSpace("viewer").catch((e=>{console.log(e)}));L=await D.requestHitTestSource({space:o}).catch((e=>{console.log(e)}))}async function onSessionEnded(e){A&&(A.visible=!0),x&&(P.add(x),x.visible=!1),N&&(N.visible=!1)}function onWindowResize(){O.xr.isPresenting||(w.aspect=document.body.clientWidth/document.body.clientHeight,w.updateProjectionMatrix(),O.setSize(document.body.clientWidth,document.body.clientHeight))}function render(e,t){if(O.xr.isPresenting){const e=t.getViewerPose(R);if(e){const o=e.views[0];T.matrix.fromArray(o.transform.matrix),T.projectionMatrix.fromArray(o.projectionMatrix),T.updateMatrixWorld(!0);const n=t.getHitTestResults(L);if(x.visible=!1,n.length>0&&x){const e=n[0].getPose(R);x.visible=!0,x.position.set(e.transform.position.x,e.transform.position.y,e.transform.position.z),x.updateMatrixWorld(!0)}O.render(P,T)}}else M.update(),O.render(P,w)}!function init(){y=document.createElement("div"),document.body.appendChild(y),P=new r,w=new l(45,window.innerHeight/window.innerWidth,1,200),function setInitialCameraPosition(){w.position.set(0,1.5,-24)}();var e=new u(16777215,12303359,1);e.position.set(.5,1,.25),P.add(e),(O=new d({antialias:!0,alpha:!0})).setPixelRatio(window.devicePixelRatio),O.setSize(document.body.clientWidth,document.body.clientHeight),O.xr.enabled=!0,y.appendChild(O.domElement),(M=new OrbitControls(w,O.domElement)).autoRotate=!0,M.autoRotateSpeed=.25,M.enablePan=!1,M.maxPolarAngle=Math.PI/2,M.target=new t(0,3,0),f.createButton(O,{requiredFeatures:["local-floor","hit-test"]}),(S=O.xr.getController(0)).addEventListener("select",(function onSelect(e){console.log("onSelect()"),O.xr.isPresenting&&N&&(N.visible=!0,N.position.copy(x.position))})),P.add(S),function loadBaseModel(){k.load("dist/models/base.ply",(e=>{(j=e.clone()).center(),j.rotateX(h.degToRad(-90)),console.log("Base model loaded"),function setHomeModel(){var e=j.clone();e.translate(0,e.boundingBox.max.y,1.25),A=new m(e,new p({vertexColors:b,size:.12})),P.add(A),console.log("Home model set")}(),function setReticleModel(){var e=j.clone();const t=.035;e.scale(t,t,t),x=new m(e,new p({vertexColors:b,size:.011,opacity:.5})),console.log("Reticle model set")}()}))}(),O.xr.addEventListener("sessionstart",onSessionStarted),O.xr.addEventListener("sessionend",onSessionEnded),window.addEventListener("resize",onWindowResize,!1),onWindowResize()}(),function animate(){O.setAnimationLoop(render)}();