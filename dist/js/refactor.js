import{S as e,P as t,W as o,O as n,M as i,a,b as r,V as s,c as l}from"./a4799280.js";let d={};function showARNotSupported(){startARbutton.setAttribute("disabled","disabled"),startARbutton.classList.add("is-disabled"),startARbutton.textContent="Mixed reality not supported"}function onXRFrame(e,t){console.log(d.session),d.gl.bindFramebuffer(d.gl.FRAMEBUFFER,d.session.renderState.baseLayer.framebuffer);const o=t.getViewerPose(d.referenceSpace);if(o){const e=o.views[0],n=d.session.renderState.baseLayer.getViewport(e);d.renderer.setSize(n.width,n.height),d.XRcamera.matrix.fromArray(e.transform.matrix),d.XRcamera.projectionMatrix.fromArray(e.projectionMatrix),d.XRcamera.updateMatrixWorld(!0);const i=t.getHitTestResults(d.hitTestSource);if(i.length>0&&d.reticle){const e=i[0].getPose(d.referenceSpace);d.reticle.visible=!0,d.reticle.position.set(e.transform.position.x,e.transform.position.y,e.transform.position.z),d.reticle.updateMatrixWorld(!0)}d.renderer.render(d.scene,d.XRcamera)}}function onWindowResize(){d.camera.aspect=window.innerWidth/window.innerHeight,d.camera.updateProjectionMatrix(),d.renderer.setSize(window.innerWidth,window.innerHeight)}!function init(){!function initStartButton(){d.startARbutton=document.querySelector(".js-start-webxr"),navigator.xr.isSessionSupported("immersive-ar").then((e=>{e?function showStartAR(){d.startARbutton.addEventListener("click",(e=>{!async function activateXR(){for(;d.scene.children.length>0;)d.scene.remove(d.scene.children[0]);(function loadMainModel(){d.plyLoader.load("dist/models/elm.ply",(e=>{e.center(),e.rotateX(i.degToRad(-90)),e.translate(0,e.boundingBox.max.y,1),d.mainModel=new a(e,new r({vertexColors:s,size:.025}));let t=d.mainModel;t.position.copy(d.reticleModel.position),t.visible=!1,d.scene.add(t),console.log("Main model loaded")}))})(),d.renderer.setClearColor(16777215,0),d.renderer.autoClear=!1,d.XRcamera=new l,d.XRcamera.matrixAutoUpdate=!1,d.session=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"]}).catch((e=>{console.log(e)})),d.session.updateRenderState({baseLayer:new XRWebGLLayer(d.session,d.gl)}),d.session.addEventListener("end",(()=>{console.log("On session end!")})),d.referenceSpace=await d.session.requestReferenceSpace("local").catch((e=>{console.log(e)}));const e=await d.session.requestReferenceSpace("viewer").catch((e=>{console.log(e)}));d.hitTestSource=await d.session.requestHitTestSource({space:e}).catch((e=>{console.log(e)})),d.session.addEventListener("select",(e=>{console.log(e,e.inputSource),d.mainModel&&(d.mainModel.visible=!0,d.mainModel.position.copy(d.reticleModel.position))}))}()}))}():showARNotSupported()})).catch(showARNotSupported)}(),d.canvas=document.querySelector(".canvas"),d.scene=new e,d.plyLoader=new t,d.gl=d.canvas.getContext("webgl",{xrCompatible:!0}),d.gl.enable(d.gl.DEPTH_TEST),d.gl.depthFunc(d.gl.LEQUAL),d.renderer=new o({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,canvas:d.canvas,context:d.gl});const c=window.innerHeight/window.innerWidth*10;d.camera=new n(-5,5,c/2,c/-2,1,100),function setInitialCameraPosition(){d.camera.position.set(4,1,4),d.camera.lookAt(0,0,0)}(),function loadInitialModel(){d.plyLoader.load("dist/models/home-elm.ply",(e=>{e.center(),e.rotateX(i.degToRad(-90)),e.translate(-1,e.boundingBox.max.y,0),d.initialModel=new a(e,new r({vertexColors:s,size:2.4})),d.initialModel.position.set(0,-3,0);let t=d.initialModel;d.scene.add(t),console.log("Home model loaded")}))}(),function loadReticleModel(){d.plyLoader.load("dist/models/home-elm.ply",(e=>{e.center(),e.rotateX(i.degToRad(-90)),e.translate(-1,e.boundingBox.max.y,0),d.reticleModel=new a(e,new r({vertexColors:s,size:2.4})),d.reticleModel.position.set(0,-3,0);let t=d.reticleModel;d.scene.add(t),console.log("Reticle model loaded")}))}(),function animation(){d.renderer.setAnimationLoop(onXRFrame)}(),window.addEventListener("resize",onWindowResize,!1)}();